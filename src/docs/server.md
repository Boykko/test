
# Chaos Age Server Requirements (Updated)

Серверная часть должна обеспечивать авторизацию, хранение коллекции и real-time взаимодействие в бою.

## 1. HTTP API (Meta-Game & Admin)

### Economy & Collection
| Method | Endpoint | Payload | Описание |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/cards` | - | Список всех карт. Учитывает `isUnlocked` для обычных игроков. |
| `POST` | `/api/upgrade` | `{ cardId: string }` | Улучшение: списывает 5 Бронзовых, выдает 1 Серебряную и т.д. |
| `POST` | `/api/craft` | `{ cardId: string }` | Создание карты за кристаллы. |

### Admin Dashboard (Require Auth)
| Method | Endpoint | Payload | Описание |
| :--- | :--- | :--- | :--- |
| `PUT` | `/api/admin/cards` | `CardData` | Обновление статов, способностей или спрайта карты. Разделение на существа и заклинания. |
| `PATCH` | `/api/admin/cards/:id/unlock` | `{ isUnlocked: boolean }` | Доступность карты для игроков. |
| `POST` | `/api/admin/abilities` | `AbilityDefinition` | Регистрация новой механики. Сервер должен валидировать `behavior`. |

## 2. WebSocket API (Battle System)

### Проверка механик (Battle Logic Validation)
Сервер обязан проверять каждую карту при розыгрыше. Если `abilityId` карты не зарегистрирован в реестре `abilities`, сервер должен:
1. Отправить событие `UNKNOWN_MECHANIC` клиенту.
2. Записать предупреждение в лог текущего боя.
3. По возможности, продолжить бой, игнорируя только ошибочную механику.

### Новые события (Client -> Server)
- `GET_DECK_CONTENTS`: Запрос списка оставшихся карт в своей колоде.
- `SEND_EMOTE`: Отправка эмодзи (`{ emoji: string }`).

### Новые события (Server -> Client)
- `DECK_CONTENTS_RESPONSE`: Отправляет массив `GameCard[]` текущих карт в колоде игрока.
- `EMOTE_RECEIVED`: Трансляция эмодзи противника.
- `CHOICE_REQUIRED`: Событие для механики "Раскопки" (Discover).
- `BATTLE_EVENT` с типом `WARNING`: Уведомление о нереализованных или неизвестных механиках.

## 3. Логика Рангов и Заклинаний
Сервер должен валидировать множители статов при загрузке карт:
- **Bronze**: 100% базы.
- **Silver**: +25% статов.
- **Gold**: +60% статов + спец. эффекты.
- **Platinum**: +100% статов.
- **Diamond**: +180% статов + уникальные способности.

**Заклинания:** Не имеют атаки и здоровья. Ранг заклинания влияет на визуальное оформление и редкость в "Раскопках".
